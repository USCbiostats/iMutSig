{
    "collab_server" : "",
    "contents" : "library(shiny)\nlibrary(dplyr)\nlibrary(rvest)\nsource('functions/sortSignature.R')\nsource(\"Background.R\")\n\n\n\nlibrary(shinydashboard)\n\nui <- dashboardPage(\n  dashboardHeader(title = \"Mutational Signatures Conversion\"),\n  dashboardSidebar(\n    sidebarMenu(\n      menuItem(\"Independent to COSMIC\", tabName = \"ind\", icon = icon(\"angle-double-right\")),\n      menuItem(\"COSMIC to Independent\", tabName = \"full\", icon = icon(\"angle-double-right\"))\n    )\n  ),\n  dashboardBody(\n    tabItems(\n      # First tab content\n      tabItem(tabName = \"ind\",\n              fluidRow(\n                \n                column(width= 4, \n                  \n                  box(\n                    title = \"Independent Signature Input\", width = NULL,\n                    selectInput(\"N_D\", \"Choose a signature:\",\n                                choices = paste0(\"D\",1:27))\n                    ),\n                    \n                  box(plotOutput(\"selected_sig_1\", height = 200), width = NULL)\n                    \n                ),    \n                  \n                  \n                column(width= 8,\n                  \n                  \n                  box(plotOutput(\"corrplot1_1\", width = 600, height = 115), width = NULL),\n                  \n                  box(plotOutput(\"corrplot1_2\", width = 600, height = 200), width = NULL)\n                  \n                  \n                )\n              ),\n                \n            \n              \n              \n              fluidRow(\n                box(\n                  width = 8, \n                  plotOutput(\"selected_sig_full_1\", height = 200)\n                ),\n                \n                box(\n                  width = 4, \n                  uiOutput(\"selected_sig_text_1_1\")\n                ),\n                \n                box(\n                  width = 8, \n                  plotOutput(\"selected_sig_full_max_1\", height = 200)\n                ),\n                \n                box(\n                  width = 4, \n                  uiOutput(\"selected_sig_text_1_2\")\n                )\n                \n              )\n                \n      ),\n      \n      # Second tab content\n      tabItem(tabName = \"full\",\n              fluidRow(\n                \n              \n              column(width= 4,   \n                     \n                box(\n                    title = \"COSMIC Signature Input\", width = NULL,\n                    selectInput(\"N_F\", \"Choose a signature:\",\n                                choices = paste0(\"F\",1:30))\n                  ),\n                \n                box(plotOutput(\"selected_sig_2\", height = 200), width = NULL)\n\n\n                ),    \n              \n              column(width = 8,\n                \n                box(plotOutput(\"corrplot2_1\", width = 600, height = 115), width = NULL),\n\n                box(plotOutput(\"corrplot2_2\", width = 600, height = 200), width = NULL)\n                \n                )\n              \n              \n              ),\n              \n              \n              fluidRow(\n                box(\n                  width = 8, \n                  plotOutput(\"selected_sig_full_2\", height = 200)\n                ),\n                \n                box(\n                  width = 4, \n                  uiOutput(\"selected_sig_text_2_1\")\n                ),\n                \n                box(\n                  width = 8, \n                  plotOutput(\"selected_sig_full_max_2\", height = 200, width = 400)\n                ),\n                \n                box(\n                  width = 4, \n                  uiOutput(\"selected_sig_text_2_2\")\n                )\n              )\n              \n      )\n      \n      )\n      \n    )\n)\n\n\nserver <- function(input, output) {\n\n  ########\n  # Page 1  \n  ########\n  \n  index <- reactive({\n    as.numeric(gsub(\"[^0-9.]\", \"\", input$N_D))\n  })\n\n  output$corrplot1_1 <- renderPlot({\n    corrplot(corr_mat[index(),,drop=FALSE], is.corr=FALSE, bg=\"#F8F8FF\",\n             col=myCol(200), tl.col=\"black\",\n             tl.cex=1.0, tl.srt=90, cl.pos=\"n\")\n    \n  })\n  \n  output$corrplot1_2 <- renderPlot({\n    corrplot(pm_corr[index(),,drop=FALSE], is.corr=FALSE, bg=\"#F8F8FF\",\n             col=myCol(200), tl.col=\"black\",\n             tl.cex=1.0, tl.srt=90, cl.pos=\"n\")\n  })\n\n  \n  output$selected_sig_1 <- renderPlot({\n    pmsignature:::visPMS_ind(Fs[[index()]], 5, isScale = TRUE)\n  })\n\n  # Page 1: correlated signature\n  \n  output$selected_sig_full_1 <- renderPlot({\n    visPMS_full_modified(convertSignatureMatrixToVector(Fs[[index()]], c(6,4,4)), 3, FALSE)\n  })\n  \n  \n  output$selected_sig_full_max_1 <- renderPlot({\n    index.max <- as.numeric(gsub(\"[^0-9.]\", \"\", names(sort(corr_mat[index(),], decreasing = TRUE)[1:1])))   \n    visPMS_full_modified(sig_full[,index.max+3], 3, FALSE)\n  })\n  \n  \n  output$selected_sig_text_1_1 <- renderText({\n    HTML(paste(\"Selected independent signature\",\"<b>\", index(), \"<b>\", \"is found in\", \n               paste(names(which(pm_corr[index(),]==1)), collapse = \", \")))\n  })\n  \n  output$selected_sig_text_1_2 <- renderText({\n    index.max <- as.numeric(gsub(\"[^0-9.]\", \"\", names(sort(corr_mat[index(),], decreasing = TRUE)[1:1])))   \n    HTML(paste(\"Similar COSIMIC signature\",\"<b>\", index.max,\"<b>\", \"is found in\", \n               paste(names(which(pm_corr[index.max,]==1)), collapse = \", \")))\n    \n    #paste(\"Similar COSMIC signature\", index.max, comment_full_mat[index.max,])\n  })\n  \n  ########\n  # Page 2\n  ########\n  \n  index2 <- reactive({\n    as.numeric(gsub(\"[^0-9.]\", \"\", input$N_F))\n  })\n  \n  output$corrplot2_1 <- renderPlot({\n    corrplot(t(corr_mat)[index2(),,drop=FALSE], is.corr=FALSE, bg=\"#F8F8FF\",\n             col=myCol(200), tl.col=\"black\",\n             tl.cex=1.0, tl.srt=90, cl.pos=\"n\")\n    \n  })\n    \n  output$corrplot2_2 <- renderPlot({\n    corrplot(cosmic_corr[index2(),,drop=FALSE], is.corr=FALSE, bg=\"#F8F8FF\",\n             col=myCol(200), tl.col=\"black\", \n             tl.cex=1.0, tl.srt=90, cl.pos=\"n\", cl.lim = c(0,1))\n    \n  })\n  \n  output$selected_sig_2 <- renderPlot({\n    visPMS_full_modified(sig_full[,index2()+3], 3, FALSE)\n  })\n\n\n  # Page 2: correlated signature\n  output$selected_sig_full_max_2 <- renderPlot({\n    index.max <- as.numeric(gsub(\"[^0-9.]\", \"\", names(sort(t(corr_mat)[index2(),], decreasing = TRUE)[1:1])))   \n    pmsignature:::visPMS_ind(Fs[[index.max]], 5, isScale = TRUE)\n  })\n  \n  output$selected_sig_full_2 <- renderPlot({\n    visPMS_full_modified(sig_full[,index2()+3], 3, FALSE)\n  })\n  \n  \n  output$selected_sig_text_2_1 <- renderText({\n    HTML(paste(\"Selected COSMIC signature\",\"<b>\", index2(),\"<b>\", \"is found in\", \n               paste(names(which(cosmic_corr[index2(),]==1)), collapse = \", \")))\n  })\n  \n  output$selected_sig_text_2_2 <- renderText({\n    index_max2 <- as.numeric(gsub(\"[^0-9.]\", \"\", names(sort(t(corr_mat)[index2(),], decreasing = TRUE)[1:1])))   \n    HTML(paste(\"Similar independent signature\",\"<b>\", index_max2,\"<b>\", \"is found in\", \n               paste(names(which(pm_corr[index_max2,]==1)), collapse = \", \")))\n  })\n  \n  \n\n}\n\nshinyApp(ui, server)",
    "created" : 1548287020715.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4128653815",
    "id" : "5E02BDD",
    "lastKnownWriteTime" : 1548293317,
    "last_content_update" : 1548293317,
    "path" : "/Volumes/GoogleDrive/My Drive/Project 4 - Tumor modeling/Github/P4-TumorModeling/Zhi_Scripts/Cosmic2pm/app.R",
    "project_path" : "app.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}